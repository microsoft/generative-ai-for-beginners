# 构建生成式 AI 驱动的聊天应用程序

[![构建生成式 AI 驱动的聊天应用程序](../../../translated_images/07-lesson-banner.png?WT.21b04c80931fcfbbce2e012cb013fa889033dc1cf59443c7c82ce598eaf13629.zh.mc_id=academic-105485-koreyst)](https://aka.ms/gen-ai-lessons7-gh?WT.mc_id=academic-105485-koreyst)

> _(点击上面的图片观看本课视频)_

在我们了解如何构建文本生成应用程序之后，让我们来看看聊天应用程序。

聊天应用程序已经融入我们的日常生活，不仅仅是提供随意对话的方式。它们是客户服务、技术支持，甚至是复杂建议系统的组成部分。很可能你不久前就通过聊天应用程序获得了一些帮助。随着我们将更先进的技术如生成式 AI 集成到这些平台中，其复杂性和挑战也随之增加。

我们需要回答的一些问题是：

- **构建应用程序**。如何高效地构建并无缝集成这些 AI 驱动的应用程序以满足特定的使用场景？
- **监控**。一旦部署后，如何监控并确保应用程序在功能和遵循 [负责任的 AI 六原则](https://www.microsoft.com/ai/responsible-ai?WT.mc_id=academic-105485-koreyst)方面达到最高质量？

随着我们进入一个由自动化和无缝人机交互定义的时代，了解生成式 AI 如何改变聊天应用程序的范围、深度和适应性变得至关重要。本课将探讨支持这些复杂系统的架构方面，深入研究为特定领域任务进行微调的方法，并评估确保负责任的 AI 部署所需的指标和考量。

## 简介

本课涵盖：

- 高效构建和集成聊天应用程序的技术。
- 如何对应用程序进行定制和微调。
- 有效监控聊天应用程序的策略和考量。

## 学习目标

在本课结束时，你将能够：

- 描述将聊天应用程序构建并集成到现有系统中的考量。
- 针对特定使用场景定制聊天应用程序。
- 识别关键指标和考量，以有效监控和维护 AI 驱动的聊天应用程序的质量。
- 确保聊天应用程序负责任地利用 AI。

## 将生成式 AI 集成到聊天应用程序中

通过生成式 AI 提升聊天应用程序不仅仅是让它们变得更智能；还包括优化它们的架构、性能和用户界面，以提供优质的用户体验。这涉及到研究架构基础、API 集成和用户界面考量。本节旨在为你提供一个全面的路线图，以便在这些复杂领域中导航，无论你是将它们集成到现有系统中还是将其构建为独立平台。

在本节结束时，你将具备高效构建和整合聊天应用程序的专业知识。

### 聊天机器人还是聊天应用程序？

在我们深入构建聊天应用程序之前，让我们比较一下“聊天机器人”和“AI 驱动的聊天应用程序”，它们承担不同的角色和功能。聊天机器人的主要目的是自动化特定的对话任务，如回答常见问题或跟踪包裹。它通常由基于规则的逻辑或复杂的 AI 算法控制。相比之下，AI 驱动的聊天应用程序是一个更广泛的环境，旨在促进各种形式的数字通信，如文本、语音和视频聊天。其定义特征是集成了一个生成式 AI 模型，该模型模拟细致入微的人类对话，根据各种输入和上下文提示生成响应。生成式 AI 驱动的聊天应用程序可以进行开放领域的讨论，适应不断发展的对话背景，甚至产生创造性或复杂的对话。

下表概述了关键的差异和相似之处，以帮助我们理解它们在数字通信中的独特角色。

| 聊天机器人                           | 生成式 AI 驱动的聊天应用程序            |
| ------------------------------------- | -------------------------------------- |
| 任务导向和基于规则                    | 上下文感知                               |
| 通常集成到更大的系统中                | 可以托管一个或多个聊天机器人             |
| 限于编程功能                          | 包含生成式 AI 模型                      |
| 专门化和结构化的交互                  | 能够进行开放领域的讨论                   |

### 利用 SDK 和 API 的预构建功能

构建聊天应用程序时，一个很好的第一步是评估现有的东西。使用 SDK 和 API 来构建聊天应用程序是一种有利的策略，原因多种多样。通过集成文档良好的 SDK 和 API，你可以战略性地为应用程序的长期成功奠定基础，解决可扩展性和维护问题。

- **加快开发过程并减少开销**：依赖预构建的功能而不是耗费成本自行构建它们，让你可以专注于应用程序中可能认为更重要的其他方面，如业务逻辑。
- **更好的性能**：从头构建功能时，你最终会问自己“它如何扩展？这个应用程序是否能够处理突然的用户激增？”良好维护的 SDK 和 API 通常内置了这些问题的解决方案。
- **更容易维护**：更新和改进更容易管理，因为大多数 API 和 SDK 只需在发布新版本时更新库即可。
- **接触尖端技术**：利用经过微调和训练的模型提供你的应用程序自然语言能力。

访问 SDK 或 API 的功能通常涉及获得使用所提供服务的权限，这通常通过使用唯一的密钥或身份验证令牌来实现。我们将使用 OpenAI Python 库来探索这是什么样的。你也可以在以下 [OpenAI 笔记本](../../../07-building-chat-applications/python/oai-assignment.ipynb) 或 [Azure OpenAI 服务笔记本](../../../07-building-chat-applications/python/aoai-assignment.ipynb) 中亲自尝试。

```python
import os
from openai import OpenAI

API_KEY = os.getenv("OPENAI_API_KEY","")

client = OpenAI(
    api_key=API_KEY
    )

chat_completion = client.chat.completions.create(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Suggest two titles for an instructional lesson on chat applications for generative AI."}])
```

上面的示例使用 GPT-3.5 Turbo 模型来完成提示，但注意在执行之前设置了 API 密钥。如果不设置密钥，你将收到错误。

## 用户体验 (UX)

一般的 UX 原则适用于聊天应用程序，但由于涉及机器学习组件，这里有一些额外的考量变得特别重要。

- **解决歧义的机制**：生成式 AI 模型有时会生成模糊的答案。一个允许用户请求澄清的功能可能会在他们遇到此问题时有所帮助。
- **上下文保留**：高级生成式 AI 模型能够在对话中记住上下文，这对用户体验可能是一个必要的资产。给予用户控制和管理上下文的能力可以改善用户体验，但也带来了保留敏感用户信息的风险。对存储这些信息的时间进行考量，例如引入保留策略，可以在上下文需求和隐私之间取得平衡。
- **个性化**：通过学习和适应，AI 模型为用户提供个性化体验。通过用户资料等功能定制用户体验不仅让用户感到被理解，还帮助他们找到特定答案，从而创造出更高效和满意的互动。

OpenAI 的 ChatGPT 中的“自定义指令”设置就是个性化的一个例子。它允许你提供关于自己的信息，这可能是你的提示的重要上下文。以下是一个自定义指令的示例。

![ChatGPT 中的自定义指令设置](../../../translated_images/custom-instructions.png?WT.11dedb56ee96f65348e96bb7d6a0e61e668da5fe777ccd5b63f23e0e7fac407b.zh.mc_id=academic-105485-koreyst)

这个“资料”提示 ChatGPT 创建关于链表的课程计划。注意 ChatGPT 考虑到用户可能希望根据她的经验获得更深入的课程计划。

![ChatGPT 中关于链表课程计划的提示](../../../translated_images/lesson-plan-prompt.png?WT.a7012bd5b8467d2255be3eb7be93a8622cf74091e2fa815e80c0118416f064fc.zh.mc_id=academic-105485-koreyst)

### 微软的大型语言模型系统消息框架

[微软提供了指导](https://learn.microsoft.com/azure/ai-services/openai/concepts/system-message#define-the-models-output-format?WT.mc_id=academic-105485-koreyst)来编写生成 LLM 响应的有效系统消息，分为四个方面：

1. 定义模型的目标用户以及其能力和限制。
2. 定义模型的输出格式。
3. 提供展示模型预期行为的具体示例。
4. 提供额外的行为保护措施。

### 无障碍性

无论用户有视觉、听觉、运动还是认知障碍，设计良好的聊天应用程序都应该可以被所有人使用。以下列表分解了旨在增强各种用户障碍的无障碍功能。

- **视觉障碍功能**：高对比度主题和可调整大小的文本，屏幕阅读器兼容性。
- **听觉障碍功能**：文本到语音和语音到文本功能，音频通知的视觉提示。
- **运动障碍功能**：支持键盘导航，语音命令。
- **认知障碍功能**：简化语言选项。

## 定制和微调领域特定语言模型

想象一下一个聊天应用程序，它理解你公司的术语并预测其用户群体通常会有的特定查询。有几种方法值得一提：

- **利用 DSL 模型**。DSL 代表领域特定语言。你可以利用所谓的 DSL 模型，它在特定领域进行训练，以理解其概念和场景。
- **应用微调**。微调是用特定数据进一步训练模型的过程。

## 定制：使用 DSL

利用领域特定语言模型（DSL 模型）可以通过提供专业的、上下文相关的交互来增强用户参与度。它是一个训练或微调以理解和生成与特定领域、行业或主题相关的文本的模型。使用 DSL 模型的选项可以从从头训练到通过 SDK 和 API 使用现有模型。另一个选项是微调，即采用现有的预训练模型并将其适应于特定领域。

## 定制：应用微调

当预训练模型在特定领域或任务中表现不佳时，通常会考虑进行微调。

例如，医疗查询复杂且需要大量上下文。当医疗专业人员诊断患者时，是基于多种因素，如生活方式或既往病史，甚至可能依赖于最近的医学期刊来验证他们的诊断。在这种细微的场景中，通用 AI 聊天应用程序不能成为可靠的来源。

### 场景：医疗应用程序

考虑一个设计用于帮助医疗从业人员的聊天应用程序，通过提供治疗指南、药物相互作用或最近研究发现的快速参考。

通用模型可能足以回答基本的医学问题或提供一般建议，但它可能在以下方面表现不佳：

- **高度特定或复杂的案例**。例如，神经学家可能会问应用程序，“目前管理儿童患者耐药性癫痫的最佳实践是什么？”
- **缺乏最新进展**。通用模型可能难以提供一个包含神经学和药理学最新进展的当前答案。

在这些情况下，使用专门的医学数据集微调模型可以显著提高其更准确和可靠地处理这些复杂医学查询的能力。这需要访问大量相关的数据集，以代表需要解决的领域特定挑战和问题。

## 高质量 AI 驱动聊天体验的考量

本节概述了“高质量”聊天应用程序的标准，包括可操作指标的捕获和遵循负责任利用 AI 技术的框架。

### 关键指标

为了保持应用程序的高质量性能，跟踪关键指标和考量是必不可少的。这些测量不仅确保了应用程序的功能，还评估了 AI 模型和用户体验的质量。以下是涵盖基本、AI 和用户体验指标的列表。

| 指标                         | 定义                                                                                                               | 聊天开发人员的考量                                                      |
| ----------------------------- | ------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------- |
| **正常运行时间**              | 测量应用程序可操作并可供用户访问的时间。                                                                            | 你将如何最大限度地减少停机时间？                                        |
| **响应时间**                  | 应用程序对用户查询的回复时间。                                                                                     | 你如何优化查询处理以提高响应时间？                                       |
| **准确率**                    | 真正预测的正数与预测的正数总数的比率                                                                               | 你将如何验证模型的准确率？                                               |
| **召回率（敏感性）**          | 真正预测的正数与实际正数的比率                                                                                     | 你将如何测量和提高召回率？                                               |
| **F1 分数**                   | 准确率和召回率的调和平均数，平衡两者之间的权衡。                                                                   | 你的目标 F1 分数是什么？你将如何平衡准确率和召回率？                      |
| **困惑度**                    | 测量模型预测的概率分布与数据的实际分布的对齐程度。                                                                 | 你将如何最大限度地减少困惑度？                                           |
| **用户满意度指标**            | 衡量用户对应用程序的感知。通常通过调查收集。                                                                       | 你将如何收集用户反馈？你将如何根据反馈进行调整？                          |
| **错误率**                    | 模型在理解或输出中犯错误的速率。                                                                                   | 你有哪些策略来减少错误率？                                               |
| **再训练周期**                | 更新模型以纳入新数据和见解的频率。                                                                                 | 你将如何频繁地再训练模型？什么会触发再训练周期？                          |
| **异常检测**                  | 用于识别不符合预期行为的异常模式的工具和技术。                                                                     | 你将如何应对异常？                                                       |

### 在聊天应用程序中实施负责任的 AI 实践

微软的负责任 AI 方法确定了六项原则，应指导 AI 的开发和使用。以下是原则、定义以及聊天开发人员应考虑的事项和原因。

| 原则                       | 微软的定义                                       | 聊天开发人员的考量                                                      | 为什么重要                                                                                         |
| -------------------------- | ------------------------------------------------ | ----------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| 公平性                     | AI 系统应公平对待所有人。                         | 确保聊天应用程序不基于用户数据进行歧视。                               | 建立用户的信任和包容性；避免法律后果。                                                             |
| 可靠性和安全性             | AI 系统应可靠、安全地运行。                       | 实施测试和故障保护措施以最大限度地减少错误和风险。                     | 确保用户满意度，防止潜在伤害。                                                                     |
| 隐私和安全                 | AI 系统应安全并尊重隐私。                         | 实施强加密和数据保护措施。                                             | 保护敏感用户数据并遵守隐私法律。                                                                  |
| 包容性                     | AI 系统应赋能所有人并吸引人们参与。               | 设计的 UI/UX 应适合多样化的受众，易于使用。                            | 确保更广泛的人群可以有效使用应用程序。                                                             |
| 透明性                     | AI 系统应易于理解。                               | 提供清晰的文档和 AI 响应的理由。                                       | 如果用户能够理解决策是如何做出的，他们更可能信任系统。                                             |
| 问责制                     | 人们应对 AI 系统负责。                             | 建立一个清晰的流程来审计和改进 AI 决策。                               | 在发生错误时能够持续改进和采取纠正措施。                                                           |

## 任务

请参阅[任务](../../../07-building-chat-applications/python)，它将带你完成一系列练习，从运行你的第一个聊天提示到分类和总结文本等。注意，任务有不同编程语言的版本！

## 干得好！继续旅程

完成本课后，查看我们的 [生成式 AI 学习集合](https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst) 以继续提升你的生成式 AI 知识！

前往第 8 课，了解如何开始 [构建搜索应用程序](../08-building-search-applications/README.md?WT.mc_id=academic-105485-koreyst)！

**免责声明**：
本文件使用机器翻译服务进行翻译。尽管我们努力确保准确性，但请注意，自动翻译可能包含错误或不准确之处。应将原文档的原始语言版本视为权威来源。对于关键信息，建议进行专业人工翻译。对于因使用本翻译而产生的任何误解或误读，我们不承担责任。